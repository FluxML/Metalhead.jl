<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Using the ResNet model family in Metalhead.jl · Metalhead.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://fluxml.ai/Metalhead.jl/stable/howto/resnet/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/flux.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Metalhead.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/quickstart/">A guide to getting started with Metalhead</a></li><li><a class="tocitem" href="../../tutorials/pretrained/">Working with pre-trained models from Metalhead</a></li></ul></li><li><span class="tocitem">Guides</span><ul><li class="is-active"><a class="tocitem" href>Using the ResNet model family in Metalhead.jl</a><ul class="internal"><li><a class="tocitem" href="#Pre-trained-models"><span>Pre-trained models</span></a></li><li><a class="tocitem" href="#The-mid-level-function"><span>The mid-level function</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../contributing/">Contributing to Metalhead</a></li><li><span class="tocitem">API reference</span><ul><li><input class="collapse-toggle" id="menuitem-5-1" type="checkbox"/><label class="tocitem" for="menuitem-5-1"><span class="docs-label">Convolutional Neural Networks</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/resnet/">ResNet-like models</a></li><li><a class="tocitem" href="../../api/densenet/">DenseNet</a></li><li><a class="tocitem" href="../../api/efficientnet/">EfficientNet family of models</a></li><li><a class="tocitem" href="../../api/mobilenet/">MobileNet family of models</a></li><li><a class="tocitem" href="../../api/inception/">Inception family of models</a></li><li><a class="tocitem" href="../../api/hybrid/">Hybrid CNN architectures</a></li><li><a class="tocitem" href="../../api/others/">Other models</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Mixers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/mixers/">MLPMixer-like models</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-3" type="checkbox"/><label class="tocitem" for="menuitem-5-3"><span class="docs-label">Vision Transformers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/vit/">Vision Transformer models</a></li></ul></li><li><a class="tocitem" href="../../api/layers/">Layers</a></li><li><a class="tocitem" href="../../api/utilities/">Model Utilities</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Guides</a></li><li class="is-active"><a href>Using the ResNet model family in Metalhead.jl</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Using the ResNet model family in Metalhead.jl</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/FluxML/Metalhead.jl/blob/master/docs/src/howto/resnet.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Using-the-ResNet-model-family-in-Metalhead.jl"><a class="docs-heading-anchor" href="#Using-the-ResNet-model-family-in-Metalhead.jl">Using the ResNet model family in Metalhead.jl</a><a id="Using-the-ResNet-model-family-in-Metalhead.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Using-the-ResNet-model-family-in-Metalhead.jl" title="Permalink"></a></h1><p>ResNets are one of the most common convolutional neural network (CNN) models used today. Originally proposed by He et al. in <a href="https://arxiv.org/abs/1512.03385"><strong>Deep Residual Learning for Image Recognition</strong></a>, they use a residual structure to learn identity mappings that strengthens gradient propagation, thereby helping to prevent the vanishing gradient problem and allow the advent of truly deep neural networks as used today.</p><p>Many variants on the original ResNet structure have since become widely used such as <a href="https://arxiv.org/abs/1605.07146">Wide-ResNet</a>, <a href="https://arxiv.org/abs/1611.05431v2">ResNeXt</a>, <a href="https://arxiv.org/abs/1709.01507">SE-ResNet</a> and <a href="https://www.notion.so/ResNet-user-guide-b4c09e5bb5ae41328165a3f160a104f6">Res2Net</a>. Apart from suggesting modifications to the structure of the residual block, papers have also suggested modifying the stem of the network, adding newer regularisation options in the form of stochastic depth and DropBlock, and changing the downsampling path for the blocks to improve performance.</p><p>Metalhead provides an extensible, hackable yet powerful interface for working with ResNets that provides built-in toggles for commonly used options in papers and other deep learning libraries, while also allowing the user to build custom model structures if they want very easily.</p><h2 id="Pre-trained-models"><a class="docs-heading-anchor" href="#Pre-trained-models">Pre-trained models</a><a id="Pre-trained-models-1"></a><a class="docs-heading-anchor-permalink" href="#Pre-trained-models" title="Permalink"></a></h2><p>Metalhead provides a variety of pretrained models in the ResNet family to allow users to get started quickly with tasks like transfer learning. Pretrained models for <a href="../../api/resnet/#Metalhead.ResNet"><code>ResNet</code></a> with depth 18, 34, 50, 101 and 152 is supported, as is <a href="../../api/resnet/#Metalhead.WideResNet"><code>WideResNet</code></a> with depths 50 and 101. <a href="../../api/resnet/#Metalhead.ResNeXt"><code>ResNeXt</code></a> also supports some configurations of pretrained models - to know more, check out the documentation for the model.</p><p>This is as easy as setting the <code>pretrain</code> keyword to <code>true</code> when constructing the model. For example, to load a pretrained <code>ResNet</code> with depth 50, you can do the following:</p><pre><code class="language-julia hljs">using Metalhead

model = ResNet(50; pretrain=true)</code></pre><p>To check out more about using pretrained models, check out the <a href="../../tutorials/pretrained/#pretrained">pretrained models guide</a>.</p><h2 id="The-mid-level-function"><a class="docs-heading-anchor" href="#The-mid-level-function">The mid-level function</a><a id="The-mid-level-function-1"></a><a class="docs-heading-anchor-permalink" href="#The-mid-level-function" title="Permalink"></a></h2><p>Metalhead also provides a function for users looking to customise the ResNet family of models further. This function is named <a href="../../api/resnet/#Metalhead.resnet"><code>Metalhead.resnet</code></a> and has a detailed docstring that describes all the various customisation options. You may want to open the above link in another tab, because we&#39;re going to be referring to it extensively to build a ResNet model of our liking.</p><p>First, let&#39;s take a peek at how we would write the vanilla ResNet-18 model using this function. At its core, a residual network is a convolutional network split into stages, where each stage contains a &quot;residual&quot; block repeated several times. The Metalhead.jl design reflects this. While there are many keyword arguments that we can configure, there are two required positional arguments–the block type and the number of times a block is repeated in each stage. For all other options, the default values work well. The original ResNet paper suggest using a &quot;basic block&quot; type and a block repetition of two. So we can write the ResNet-18 model as follows:</p><pre><code class="language-julia hljs">resnet18 = Metalhead.resnet(Metalhead.basicblock, [2, 2, 2, 2])</code></pre><p>What if we want to customise the number of output classes? That&#39;s easy; the model has several keyword arguments, one of which allows this. The docstring tells us that it is <code>nclasses</code>, and so we can write:</p><pre><code class="language-julia hljs">resnet18 = Metalhead.resnet(Metalhead.basicblock, [2, 2, 2, 2]; nclasses = 10)</code></pre><p>Let&#39;s try customising this further. Say I want to make a ResNet-50-like model, but with <a href="https://arxiv.org/abs/1603.09382"><code>StochasticDepth</code></a> to provide even more regularisation, and also a custom pooling layer such as <code>AdaptiveMeanMaxPool</code>. Both of these options are provided by Metalhead out of the box, and so we can write:</p><pre><code class="language-julia hljs">using Metalhead: Layers # AdaptiveMeanMaxPool is in the Layers module in Metalhead

custom_resnet = Metalhead.resnet(Metalhead.bottleneck, [3, 4, 6, 3];
                                 pool_layer = Layers.AdaptiveMeanMaxPool((1, 1)),
                                 stochastic_depth_prob = 0.2)</code></pre><p>To make this a ResNeXt-like model, all we need to do is configure the cardinality and the  base width:</p><pre><code class="language-julia hljs">custom_resnet = Metalhead.resnet(Metalhead.bottleneck, [3, 4, 6, 3];
                                 cardinality = 32, base_width = 4,
                                 pool_layer = Layers.AdaptiveMeanMaxPool((1, 1)),
                                 stochastic_depth_prob = 0.2)</code></pre><p>And we have a custom model, built with minimal effort! The documentation for <code>Metalhead.resnet</code> has been written with extensive care and in as much detail as possible to facilitate ease of use. Still, if you find anything difficult to understand, feel free to open an issue and we will be happy to help you out, and to improve the documentation where necessary.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../tutorials/pretrained/">« Working with pre-trained models from Metalhead</a><a class="docs-footer-nextpage" href="../../contributing/">Contributing to Metalhead »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Tuesday 6 June 2023 15:41">Tuesday 6 June 2023</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
